"use strict";document.addEventListener("DOMContentLoaded",(()=>{}));const mobileSize=768,sidebar=document.querySelector(".sidebar"),sidebarInfo=sidebar.querySelector(".sidebar-info"),sidebarInfoRunningCount=sidebar.querySelector(".sidebar-info .count--running .count"),sidebarInfoCyclingCount=sidebar.querySelector(".sidebar-info .count--cycling .count"),sidebarEls=sidebar.querySelectorAll(".sidebar-el"),mapTile=document.querySelector("#map"),workoutsBlock=sidebar.querySelector(".workouts"),workoutsAllTabs=sidebar.querySelectorAll(".tab"),workoutForm=sidebar.querySelector(".workouts__form"),workoutsContainer=sidebar.querySelector(".workouts__items"),workoutEmptyMessage=sidebar.querySelector(".workouts__empty-message"),workoutsStats=sidebar.querySelector(".workouts__stats"),workoutsStatsRows=sidebar.querySelectorAll(".workouts__stats .stats__row"),workoutsStatsQty=workoutsStats.querySelector("#quantity"),workoutsStatsRunningQty=workoutsStats.querySelector("#running-quantity"),workoutsStatsCyclingQty=workoutsStats.querySelector("#cycling-quantity"),workoutsStatsDistance=workoutsStats.querySelector("#distance"),workoutsStatsDuration=workoutsStats.querySelector("#duration"),modal=document.querySelector(".modal"),modalClose=modal.querySelector(".modal-close"),modalText=modal.querySelector(".modal-text"),modalBtn=modal.querySelector(".modal-btn"),actionsTabsContainer=sidebar.querySelector(".actions__tabs"),actionsTabsBtns=sidebar.querySelectorAll(".actions__tabs .actions__tab"),actionsTabsWorkoutsItems=sidebar.querySelector('.actions__tabs [data-tab=".workouts__items"]'),actionsSortLabel=sidebar.querySelector(".actions__sort-btn .label"),btnActionsDeleteAll=sidebar.querySelector(".actions__delete-all-btn"),btnActionsSort=sidebar.querySelector(".actions__sort-btn"),btnSidebarSwitch=sidebar.querySelector(".sidebar__status-switch-btn"),btnRemoveForm=workoutForm.querySelector("#remove-form-btn"),btnsDeleteWorkout=workoutsContainer.querySelector(".item__delete-workout"),inputType=workoutForm.querySelector("#form__type"),inputDistance=workoutForm.querySelector("#form__distance"),inputDuration=workoutForm.querySelector("#form__duration"),inputTemp=workoutForm.querySelector("#form__temp"),inputClimb=workoutForm.querySelector("#form__climb"),inputsFormValid=workoutForm.querySelectorAll(".form-input--valid");class EventManager{constructor(){this._setEmptyWorkoutsTitle(),this._setAdditionalStyles(),modalClose.addEventListener("click",this._closeModal)}_switchSidebar(){const t=sidebar.classList.contains("_hidden");if(!t)return void function(){const t=btnSidebarSwitch.getBoundingClientRect().width,e=sidebar.getBoundingClientRect().width;btnSidebarSwitch.classList.add("_hidden"),sidebar.classList.add("_hidden"),sidebar.style.transform=`translateX(calc(-100% + ${t}px))`,sidebarInfo.classList.remove("_hidden"),sidebarEls.forEach((t=>t.classList.add("sidebar--hidden-el"))),window.screen.width<=768?(mapTile.style.marginLeft=0,mapTile.style.width=`calc(100vw - ${t}px)`):mapTile.style.marginLeft=`-${e-t}px`}();t&&(btnSidebarSwitch.classList.remove("_hidden"),sidebar.classList.remove("_hidden"),sidebar.style.transform="none",sidebarInfo.classList.add("_hidden"),sidebarEls.forEach((t=>t.classList.remove("sidebar--hidden-el"))),mapTile.style.transform="none",mapTile.style.marginLeft="0")}_setEmptyWorkoutsTitle(){workoutsContainer.querySelector(".workout__item")||!workoutForm.classList.contains("_hidden")?workoutEmptyMessage.classList.add("_hidden"):workoutEmptyMessage.classList.remove("_hidden")}_openModal({text:t="Помилка",close:e=!0,overlayColor:o="rgba(0, 0, 0, 0.6)",overlayClick:s=!0,animate:i=!0,btn:r={active:!1,text:"",color:"",backgroundColor:"",action:!1}}){modalText.textContent=t,modal.style.backgroundColor=o,modal.classList.remove("_hidden"),i?modal.classList.add("animation"):modal.classList.remove("animation"),e?modalClose.classList.remove("hidden"):modalClose.classList.add("hidden"),r.active?(modalBtn.classList.remove("hidden"),modalBtn.textContent=r.text,modalBtn.style.color=r.color,modalBtn.style.backgroundColor=r.backgroundColor,r.action&&r.action()):modalBtn.classList.add("hidden");const a=function(t){t.target.classList.contains("modal")&&this._closeModal()};s&&modal.addEventListener("click",a.bind(this))}_closeModal(){modal.classList.add("_hidden")}_setAdditionalStyles(){workoutsStatsRows.forEach(((t,e)=>{--e%2&&(t.style.backgroundColor="#333")}))}}const eventManager=new EventManager;class Workout{date=new Date;id=crypto.randomUUID().slice(-8);marker;constructor({coords:t,marker:e,distance:o,duration:s}){this.coords=t,this.distance=o,this.duration=s,this.marker=e,this._setDescription()}_setDescription(){this.dateLocale=Intl.DateTimeFormat("uk-UA").format(this.date)}}class Running extends Workout{type="running";constructor({coords:t,marker:e,distance:o,duration:s,temp:i}){super({coords:t,marker:e,distance:o,duration:s}),this.temp=i,this._calcPace()}_calcPace(){this.pace=this.duration/this.distance}}class Cycling extends Workout{type="cycling";constructor({coords:t,marker:e,distance:o,duration:s,climb:i}){super({coords:t,marker:e,distance:o,duration:s}),this.climb=i,this._calcSpeed()}_calcSpeed(){this.speed=this.distance/this.duration/60}}class App{zoom=14.5;#t;#e;#o;#s=[];#i=!1;#r;#a={sortType:0,sortTypeMaxQty:3};constructor(){this._getPosition(),this._updateStats(),btnSidebarSwitch.addEventListener("click",this._fixMap.bind(this)),inputType.addEventListener("change",this._switchType),workoutsContainer.addEventListener("click",this._deleteWorkout.bind(this)),workoutsContainer.addEventListener("click",this._moveToWorkout.bind(this)),btnActionsDeleteAll.addEventListener("click",this._deleteAllWorkouts.bind(this)),btnActionsSort.addEventListener("click",this._sortWorkouts.bind(this)),actionsTabsContainer.addEventListener("click",this._switchTabs),window.addEventListener("keydown",this._keyboardManager.bind(this))}_getPosition(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(this._loadMap.bind(this),(function(){eventManager._openModal({text:"Сайт взаємодіє з вашою гелокацією для показу карти з вашим теперешнім місцезнаходженням, тому вам потрібно дати дозвіл до геолокацї для сайту в налаштуваннях браузеру!",animate:!1,close:!1,overlayColor:"#222",overlayClick:!1,btn:{active:!0,text:"Перезапустити",color:"white",backgroundColor:"rgb(197, 20, 20)",action:function(){modalBtn.addEventListener("click",(function(){location.reload()}))}}})}))}_loadMap(t){const{latitude:e,longitude:o}=t.coords;this.#o=[e,o],this.#t=L.map("map"),this.#t.setView(this.#o,this.zoom),this._getLocaleStorageData();L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(this.#t),this.#t.on("click",this._showForm.bind(this))}_fixMap(){eventManager._switchSidebar();const t=1e3*parseFloat(window.getComputedStyle(sidebar).transitionDuration);setTimeout((()=>{this.#t.invalidateSize()}),t)}_showForm(t){actionsTabsBtns.forEach((t=>t.classList.remove("_active-tab"))),workoutsAllTabs.forEach((t=>t.classList.remove("_active-tab"))),actionsTabsWorkoutsItems.classList.add("_active-tab"),workoutsContainer.classList.add("_active-tab");const{lat:e,lng:o}=t.latlng;this.#e=[e,o],workoutForm.classList.contains("_hidden")||(workoutForm.classList.add("_error-anim-1"),workoutForm.addEventListener("animationend",(()=>{workoutForm.classList.remove("_error-anim-1")}))),workoutsBlock.scrollTo({top:0,behavior:"smooth"}),sidebar.classList.contains("_hidden")&&this._fixMap(),this.#i||(this.#r=L.marker(this.#e).addTo(this.#t),this.#i=!this.#i,workoutForm.classList.remove("_hidden"),workoutsContainer.classList.remove("_remove-padding"),eventManager._setEmptyWorkoutsTitle(),btnRemoveForm.addEventListener("click",this._removeForm.bind(this)))}_hideForm(){this.#i=!1,inputDistance.value=inputDuration.value=inputTemp.value=inputClimb.value="",workoutForm.classList.add("_hidden"),workoutsContainer.classList.add("_remove-padding")}_removeForm(){this._hideForm(),this.#r.remove(),eventManager._setEmptyWorkoutsTitle()}_switchType(t){function e(t,e){const o=".form__cell";t.closest(o).classList.add("_hidden"),e.closest(o).classList.remove("_hidden")}const o=t.target.value;"running"===o&&e(inputClimb,inputTemp),"cycling"===o&&e(inputTemp,inputClimb)}_createWorkout(){if(workoutForm.classList.contains("_hidden"))return;const t=function(...t){return t.every((t=>Number.isFinite(t&&+t)))},e=function(...e){workoutForm.classList.add("_error-anim"),workoutForm.addEventListener("animationend",(function(){workoutForm.classList.remove("_error-anim")})),e.forEach((e=>{t(e.value)||(e.classList.add("_error-anim"),e.addEventListener("animationend",(function(){e.classList.remove("_error-anim")})))}))},o=inputType.value,s=inputDistance.value,i=inputDuration.value;let r;if("running"===o){const o=inputTemp.value;if(!t(s,i,o))return void e(inputDistance,inputDuration,inputTemp);r=new Running({coords:this.#e,marker:this.#r,distance:+s,duration:+i,temp:+o})}if("cycling"===o){const o=inputClimb.value;if(!t(s,i,o))return void e(inputDistance,inputDuration,inputClimb);r=new Cycling({coords:this.#e,marker:this.#r,distance:+s,duration:+i,climb:+o})}this.#s.push(r),this._setLocaleStorageData(),this._displayPupupForMarker(r),this._hideForm(),this.#a.sortType--,this._sortWorkouts()}_displayPupupForMarker(t,e=!0){let o;"running"===t.type&&(o="Пробіжка"),"cycling"===t.type&&(o="Велоїзда"),t.marker.bindPopup(L.popup({maxWidth:400,minWidth:100,autoClose:!1,closeOnClick:!1,className:`workout--${t.type} workout--popup-${t.id}`,autoPan:e,autoPanPadding:L.point(40,40)})).setPopupContent(`${o} ${t.dateLocale}`).openPopup()}_displayWorkout(t,e=!0){let o;"running"===t.type&&(o="Пробіжка"),"cycling"===t.type&&(o="Велоїзда");let s=`<div class="workout__item item workout--${t.type}" data-id="${t.id}">\n            <div class="item__delete-workout">\n                <span>&times;</span>\n            </div>\n\n            <h3 class="item__name">${o} <span>${t.dateLocale}</span></h3>\n\n            <main class="item__cells">\n                <div class="item__cell">\n                    <p class="item__description">Дистанція</p>\n                    <p class="item__value">${t.distance} <span class="unit">км</span></p>\n                </div>\n                <div class="item__cell">\n                    <p class="item__description">Час</p>\n                    <p class="item__value">${t.duration} <span class="unit">хв</span></p>\n                </div>`;"running"===t.type&&(s+=`<div class="item__cell">\n                    <p class="item__description">К-ть кілометрів за хв</p>\n                    <p class="item__value">\n                        ${t.pace.toFixed(2)} <span class="unit">хв/м</span>\n                    </p>\n                </div>\n\n                <div class="item__cell">\n                    <p class="item__description">Темп</p>\n                    <p class="item__value">\n                        ${t.temp} <span class="unit">крок/хв</span>\n                    </p>\n                </div>\n            </main>\n        </div>`),"cycling"===t.type&&(s+=`<div class="item__cell">\n                    <p class="item__description">Швидкість</p>\n                    <p class="item__value">\n                        ${t.speed.toFixed(2)} <span class="unit">км/г</span>\n                    </p>\n                </div>\n\n                <div class="item__cell">\n                    <p class="item__description">Висота</p>\n                    <p class="item__value">${t.climb} <span class="unit">м</span></p>\n                </div>\n            </main>\n        </div>`),workoutsContainer.insertAdjacentHTML("afterbegin",s),e&&this._updateStats()}_keyboardManager(t){switch(t.code){case"Enter":case"Space":case"NumpadEnter":this._createWorkout()}}_deleteWorkout(t){const e=t.target.closest(".item__delete-workout");if(null===e||!e.classList.contains("item__delete-workout"))return;const o=e.closest(".workout__item"),s=o.dataset.id,i=this.#s.find((t=>t.id===s));i.marker.remove();const r=this.#s.indexOf(i);this.#s.splice(r,1),o.classList.add("deleting-animation"),o.addEventListener("animationend",(()=>{o.remove(),eventManager._setEmptyWorkoutsTitle(),this._updateStats()})),this._setLocaleStorageData()}_moveToWorkout(t){const e=t.target.closest(".workout__item");if(!e)return;window.screen.width<=768&&eventManager._switchSidebar();const o=e.dataset.id,s=this.#s.find((t=>t.id===o));s&&(s.marker.openPopup(),this.#t.setView(s.coords,this.zoom+1))}_deleteAllWorkouts(){if(!this.#s.length)return void eventManager._openModal({text:"У вас немає треніровок."});const t=function(){this.#s.forEach((t=>t.marker.remove())),this.#s=[],this._updateStats(),workoutsContainer.innerHTML="",eventManager._closeModal(),workoutsContainer.classList.contains("_active-tab")&&eventManager._setEmptyWorkoutsTitle(),this._setLocaleStorageData()}.bind(this);eventManager._openModal({text:"Ви впевнені? Ця дія видалить всі треніровки.",btn:{active:!0,text:"Видалити всі",color:"white",backgroundColor:"rgb(197, 20, 20)",action:function(){modalBtn.addEventListener("click",t)}}})}_sortWorkouts(){this.#a.sortType!==this.#a.sortTypeMaxQty?this.#a.sortType++:this.#a.sortType=0;const t=function({text:t="Сортування",sortValue:e="date",order:o="lr"}){actionsSortLabel.textContent=t,workoutsContainer.innerHTML="";this.#s.slice().sort((function(t,s){return"lr"===o?t[e]-s[e]:"rl"===o?s[e]-t[e]:void 0})).forEach((t=>this._displayWorkout(t)))}.bind(this);0===this.#a.sortType&&t({text:"Новіші",sortValue:"date",order:"lr"}),1===this.#a.sortType&&t({text:"Старіші",sortValue:"date",order:"rl"}),2===this.#a.sortType&&t({text:"Довші (км)",sortValue:"distance",order:"lr"}),3===this.#a.sortType&&t({text:"Довші (хв)",sortValue:"duration",order:"lr"})}_setLocaleStorageData(){const t=this.#s.map((t=>{const e={type:t.type,date:t.date,id:t.id,coords:t.coords,distance:t.distance,duration:t.duration,dateLocale:t.dateLocale};return"running"===t.type?{...e,temp:t.temp,pace:t.pace}:"cycling"===t.type?{...e,climb:t.climb,speed:t.speed}:void 0}));localStorage.setItem("workouts",JSON.stringify(t))}_getLocaleStorageData(){const t=JSON.parse(localStorage.getItem("workouts"));t&&(this.#s=t,this.#s.forEach(function(t){this._displayWorkout(t,!1),this._displayWorkoutsAllMarkers(t)}.bind(this)),this._updateStats(),eventManager._setEmptyWorkoutsTitle())}_displayWorkoutsAllMarkers(t){t.marker=L.marker(t.coords).addTo(this.#t),this._displayPupupForMarker(t,!1)}_switchTabs(t){const e=t.target.closest(".actions__tab");if(!e)return;if(!workoutForm.classList.contains("_hidden"))return workoutForm.classList.add("_error-anim-1"),workoutForm.addEventListener("animationend",(()=>{workoutForm.classList.remove("_error-anim-1")})),void workoutsBlock.scrollTo({top:0,behavior:"smooth"});actionsTabsBtns.forEach((t=>t.classList.remove("_active-tab"))),e.classList.add("_active-tab");const o=document.querySelector(e.dataset.tab);workoutsAllTabs.forEach((t=>t.classList.remove("_active-tab"))),o.classList.add("_active-tab"),o.classList.contains("workouts__items")?eventManager._setEmptyWorkoutsTitle():workoutEmptyMessage.classList.add("_hidden")}_updateStats(){const t=this.#s.length,e=this.#s.filter((t=>"running"===t.type)).length,o=this.#s.filter((t=>"cycling"===t.type)).length,s=this.#s.map((t=>t.distance)).reduce(((t,e)=>t+e),0),i=this.#s.map((t=>t.duration)).reduce(((t,e)=>t+e),0),r=function(t,e){t.textContent=e};r(sidebarInfoRunningCount,e),r(sidebarInfoCyclingCount,o),r(workoutsStatsQty,t),r(workoutsStatsRunningQty,e),r(workoutsStatsCyclingQty,o),r(workoutsStatsDistance,s),r(workoutsStatsDuration,i)}}const app=new App;
//# sourceMappingURL=app.js.map